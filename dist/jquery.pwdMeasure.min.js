/*!
 * jQuery.pwdMeasure
 * jQuery plugin to measure the strength of the password.
 * @version 1.0.1
 * @author tsuyoshiwada
 * @license MIT
 */
!function(e,t,s){"use strict";function a(){this._initialize.apply(this,arguments)}function r(e,t,a){return Array.prototype.slice.call(e,t,a!==s?a:e.length)}function i(e){var t=e+"",s=t.charCodeAt(0);if(s>=55296&&56319>=s){var a=s;if(1===t.length)return s;var r=t.charCodeAt(1);return 1024*(a- -55296)+(r-56320)+65536}return s>=56320&&57343>=s?s:s}var n="1.0.1",l=12,o={VALID:1,INVALID:2,NOT_MATCH:3,EMPTY:4},c={score:100,label:"","class":""},h={minScore:50,minLength:6,events:"keyup change",labels:[{score:10,label:"とても弱い","class":"very-weak"},{score:30,label:"弱い","class":"weak"},{score:50,label:"平均","class":"average"},{score:70,label:"強い","class":"strong"},{score:100,label:"とても強い","class":"very-strong"},{score:"notMatch",label:"不一致","class":"not-match"},{score:"empty",label:"未入力","class":"empty"}],indicator:"#pm-indicator",indicatorTemplate:"パスワード強度: <%= label %> (<%= percentage %>%)",confirm:!1,onValid:!1,onInvalid:!1,onNotMatch:!1,onEmpty:!1,onChangeState:!1,onChangeValue:!1},p="pm";a.prototype={version:n,options:{},eventName:"",percentage:0,"char":{numbers:[],upperLetters:[],lowerLetters:[],specialChars:[]},indicatorDefaultHtml:"",status:o.INVALID,currentLabelObj:{},$elem:null,$indicator:null,$confirm:null},a.prototype._initialize=function(t,s){this.options=s,this.options.labels=e.map(this.options.labels,function(t){return e.extend({},c,t)});var a;for(a=48;58>a;a++)this["char"].numbers.push(a);for(a=65;91>a;a++)this["char"].upperLetters.push(a);for(a=97;123>a;a++)this["char"].lowerLetters.push(a);for(a=32;48>a;a++)this["char"].specialChars.push(a);for(a=58;65>a;a++)this["char"].specialChars.push(a);for(a=91;97>a;a++)this["char"].specialChars.push(a);for(a=123;127>a;a++)this["char"].specialChars.push(a);this.$elem=t,this.$indicator=e(this.options.indicator),this.$confirm=e(this.options.confirm),this.$indicator.size()>0&&(this.indicatorDefaultHtml=this.$indicator.html()),this.update(),this._bindMethods()},a.prototype.calc=function(){var t,s,a=0,r={numbers:0,upperLetters:0,lowerLetters:0,specialChars:0},n=this.$elem.val();for(a+=2*Math.floor(n.length/this.options.minLength),t=0;t<n.length;t++)s=i(n.charAt(t)),-1!=e.inArray(s,this["char"].numbers)&&r.numbers<2?(a++,r.numbers++):-1!=e.inArray(s,this["char"].upperLetters)&&r.upperLetters<2?(a++,r.upperLetters++):-1!=e.inArray(s,this["char"].lowerLetters)&&r.lowerLetters<2?(a++,r.lowerLetters++):-1!=e.inArray(s,this["char"].specialChars)&&r.specialChars<2&&(a++,r.specialChars++);a=a>l?l:a,this.percentage=Math.ceil(100*a/l),this.percentage=this.percentage>100?100:this.percentage},a.prototype.getLabelIndex=function(t,s){var a=this,r=0;return t=t||a.percentage,s=s||a.status,e.each(a.options.labels,function(i,n){var l=a.options.labels[i-1]||{score:0,label:"","class":""};if(e.isNumeric(n.score)){if(!e.isNumeric(l.score))return!0;l.score=parseInt(l.score),n.score=parseInt(n.score),t>l.score&&t<=n.score&&(r=i)}else if("empty"===n.score&&s===o.EMPTY||"notMatch"===n.score&&s===o.NOT_MATCH)return r=i,!1}),r},a.prototype.getLabelObj=function(e,t){var s=this.getLabelIndex(e,t);return this.options.labels[s]},a.prototype.update=function(){var e=this.status,t=this.$elem.val(),s=this.$confirm.val(),a=this.$confirm.size();this.calc(),e=a>0?""!==s?t===s?this.percentage>=this.options.minScore?o.VALID:o.INVALID:o.NOT_MATCH:""===t?o.EMPTY:o.INVALID:this.percentage>=this.options.minScore?o.VALID:""===t?o.EMPTY:o.INVALID;var r=this.status!==e;if(this.status=e,this.currentLabelObj=this.getLabelObj(null,e),this._displayIndicator(),this._callbackApply(this.options.onChangeValue,this.percentage,this.currentLabelObj.label,this.currentLabelObj["class"]),r){var i;switch(this.status){case o.VALID:i="valid",this._callbackApply(this.options.onValid,this.percentage,this.currentLabelObj.label,this.currentLabelObj["class"]);break;case o.INVALID:i="invalid",this._callbackApply(this.options.onInvalid,this.percentage,this.currentLabelObj.label,this.currentLabelObj["class"]);break;case o.EMPTY:i="empty",this._callbackApply(this.options.onEmpty,this.percentage,this.currentLabelObj.label,this.currentLabelObj["class"]);break;case o.NOT_MATCH:i="notMatch",this._callbackApply(this.options.onNotMatch,this.percentage,this.currentLabelObj.label,this.currentLabelObj["class"])}this._callbackApply(this.options.onChangeState,this.percentage,this.currentLabelObj.label,this.currentLabelObj["class"],i)}},a.prototype._displayIndicator=function(){if(0===this.$indicator.size())return!1;var t=this.options.indicatorTemplate,s={label:this.currentLabelObj.label,"class":this.currentLabelObj["class"],percentage:this.percentage};e.each(s,function(e,s){t=t.split("<%= "+e+" %>").join(s)}),t=t.replace(/(<%= .* %>?)/g,""),this.$indicator.html(t).removeClass(this._allLabelClass()).addClass(this.currentLabelObj["class"])},a.prototype._bindMethods=function(){var t=this;t.eventName=t.options.events||"keyup",t.eventName=t.eventName.replace(/([a-z]+)( ?)/gi,"$1."+p+"$2"),t.$elem.on(t.eventName,e.proxy(t.update,t)),t.$confirm.size()>0&&t.$confirm.on(t.eventName,e.proxy(t.update,t))},a.prototype._unbindMethods=function(){},a.prototype._callbackApply=function(){var t=arguments[0],s=r(arguments,1),a=e.isFunction(t)?t:function(){};return a.apply(this.$elem.get(0),s)},a.prototype._allLabelClass=function(){var t=e.map(this.options.labels,function(e){return e["class"]});return t.join(" ")},a.prototype.destroy=function(){this._unbindMethods(),this.$elem.removeData("pwdMeasure"),this.$indicator.size()>0&&this.$indicator.html(this.indicatorDefaultHtml).removeClass(this._allLabelClass())},e.fn.pwdMeasure=function(t){return this.each(function(){e(this).data("pwdMeasure")||e(this).data("pwdMeasure",new a(e(this),e.extend({},h,t)))})}}(jQuery,window);