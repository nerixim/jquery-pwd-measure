/*!
 * jQuery.pwdMeasure 
 * version: 1.0.0
 * license: MIT
 * copyright: tsuyoshiwada 2015 All Right Reserved.
 * build: 2015-01-24 17:44:41 GMT+0900
 */
!function(a,b,c){"use strict";function d(){this._initialize.apply(this,arguments)}function e(a,b,d){return Array.prototype.slice.call(a,b,d!==c?d:a.length)}function f(a){var b=a+"",c=b.charCodeAt(0);if(c>=55296&&56319>=c){var d=c;if(1===b.length)return c;var e=b.charCodeAt(1);return 1024*(d- -55296)+(e-56320)+65536}return c>=56320&&57343>=c?c:c}var g="1.0.0",h=12,i={VALID:1,INVALID:2,NOT_MATCH:3},j={score:100,label:"","class":""},k={minScore:50,minLength:6,events:"keyup change",labels:[{score:10,label:"とても弱い","class":"very-weak"},{score:30,label:"弱い","class":"weak"},{score:50,label:"平均","class":"average"},{score:70,label:"強い","class":"strong"},{score:100,label:"とても強い","class":"very-strong"},{score:"notMatch",label:"不一致","class":"not-match"}],indicator:"#pm-indicator",indicatorTemplate:"パスワード強度: <%= label %> (<%= percentage %>%)",confirm:!1,onValid:!1,onInvalid:!1,onNotMatch:!1,onChangeState:!1,onChangeValue:!1},l="pm";d.prototype={version:g,options:{},eventName:"",percentage:0,"char":{numbers:[],upperLetters:[],lowerLetters:[],specialChars:[]},indicatorDefaultHtml:"",status:i.INVALID,currentLabelObj:{},$elem:null,$indicator:null,$confirm:null},d.prototype._initialize=function(b,c){this.options=c,this.options.labels=a.map(this.options.labels,function(b){return a.extend({},j,b)});var d;for(d=48;58>d;d++)this["char"].numbers.push(d);for(d=65;91>d;d++)this["char"].upperLetters.push(d);for(d=97;123>d;d++)this["char"].lowerLetters.push(d);for(d=32;48>d;d++)this["char"].specialChars.push(d);for(d=58;65>d;d++)this["char"].specialChars.push(d);for(d=91;97>d;d++)this["char"].specialChars.push(d);for(d=123;127>d;d++)this["char"].specialChars.push(d);this.$elem=b,this.$indicator=a(this.options.indicator),this.$confirm=a(this.options.confirm),this.$indicator.size()>0&&(this.indicatorDefaultHtml=this.$indicator.html()),this.update(),this._bindMethods()},d.prototype.calc=function(){var b,c,d=0,e={numbers:0,upperLetters:0,lowerLetters:0,specialChars:0},g=this.$elem.val();for(d+=2*Math.floor(g.length/this.options.minLength),b=0;b<g.length;b++)c=f(g.charAt(b)),-1!=a.inArray(c,this["char"].numbers)&&e.numbers<2?(d++,e.numbers++):-1!=a.inArray(c,this["char"].upperLetters)&&e.upperLetters<2?(d++,e.upperLetters++):-1!=a.inArray(c,this["char"].lowerLetters)&&e.lowerLetters<2?(d++,e.lowerLetters++):-1!=a.inArray(c,this["char"].specialChars)&&e.specialChars<2&&(d++,e.specialChars++);d=d>h?h:d,this.percentage=Math.ceil(100*d/h),this.percentage=this.percentage>100?100:this.percentage},d.prototype.getLabelIndex=function(b,c){var d=this,e=0;return b=b||d.percentage,c=c||d.status,a.each(d.options.labels,function(f,g){var h=d.options.labels[f-1]||{score:0,label:"","class":""};if(a.isNumeric(g.score)){if(!a.isNumeric(h.score))return!0;h.score=parseInt(h.score),g.score=parseInt(g.score),b>h.score&&b<=g.score&&(e=f)}else if("notMatch"===g.score&&c===i.NOT_MATCH)return e=f,!1}),e},d.prototype.getLabelObj=function(a,b){var c=this.getLabelIndex(a,b);return this.options.labels[c]},d.prototype.update=function(){var a=this.status;if(this.calc(),this.$confirm.size()>0){var b=this.$elem.val(),c=this.$confirm.val();a=""!==c?b===c?this.percentage>=this.options.minScore?i.VALID:i.INVALID:i.NOT_MATCH:i.INVALID}else a=this.percentage>=this.options.minScore?i.VALID:i.INVALID;var d=this.status!==a;if(this.status=a,this.currentLabelObj=this.getLabelObj(null,a),this._displayIndicator(),this._callbackApply(this.options.onChangeValue,this.percentage,this.currentLabelObj.label,this.currentLabelObj["class"]),d){var e;switch(this.status){case i.VALID:e="valid",this._callbackApply(this.options.onValid,this.percentage,this.currentLabelObj.label,this.currentLabelObj["class"]);break;case i.INVALID:e="invalid",this._callbackApply(this.options.onInvalid,this.percentage,this.currentLabelObj.label,this.currentLabelObj["class"]);break;case i.NOT_MATCH:e="notMatch",this._callbackApply(this.options.onNotMatch,this.percentage,this.currentLabelObj.label,this.currentLabelObj["class"])}this._callbackApply(this.options.onChangeState,this.percentage,this.currentLabelObj.label,this.currentLabelObj["class"],e)}},d.prototype._displayIndicator=function(){if(0===this.$indicator.size())return!1;var b=this.options.indicatorTemplate,c={label:this.currentLabelObj.label,"class":this.currentLabelObj["class"],percentage:this.percentage};a.each(c,function(a,c){b=b.split("<%= "+a+" %>").join(c)}),b=b.replace(/(<%= .* %>?)/g,""),this.$indicator.html(b).removeClass(this._allLabelClass()).addClass(this.currentLabelObj["class"])},d.prototype._bindMethods=function(){var b=this;b.eventName=b.options.events||"keyup",b.eventName=b.eventName.replace(/([a-z]+)( ?)/gi,"$1."+l+"$2"),b.$elem.on(b.eventName,a.proxy(b.update,b)),b.$confirm.size()>0&&b.$confirm.on(b.eventName,a.proxy(b.update,b))},d.prototype._unbindMethods=function(){},d.prototype._callbackApply=function(){var b=arguments[0],c=e(arguments,1),d=a.isFunction(b)?b:function(){};return d.apply(this.$elem.get(0),c)},d.prototype._allLabelClass=function(){var b=a.map(this.options.labels,function(a){return a["class"]});return b.join(" ")},d.prototype.destroy=function(){this._unbindMethods(),this.$elem.removeData("pwdMeasure"),this.$indicator.size()>0&&this.$indicator.html(this.indicatorDefaultHtml).removeClass(this._allLabelClass())},a.fn.pwdMeasure=function(b){return this.each(function(){a(this).data("pwdMeasure")||a(this).data("pwdMeasure",new d(a(this),a.extend({},k,b)))})}}(jQuery,window);